//===================================================================================================================================
//yDigitalShiftState.cppz
// [ì¬ŽÒ]HAL“Œ‹žGP12A332 11 ›–ì Ž÷
// [ì¬“ú]2019/11/17
// [XV“ú]2019/11/24
//===================================================================================================================================

//===================================================================================================================================
//yƒCƒ“ƒNƒ‹[ƒhz
//===================================================================================================================================
#include "DigitalShiftState.h"
#include "NormalState.h"

//===================================================================================================================================
//yusingéŒ¾z
//===================================================================================================================================
using namespace playerNS;
using namespace digitalShiftNS;

//===================================================================================================================================
//yƒRƒ“ƒXƒgƒ‰ƒNƒ^z
//===================================================================================================================================
DigitalShiftState::DigitalShiftState(Player* player):AbstractState()
{
	//‹¤’Ê€–Ú
	this->player = player;
	stateTimer	= 0.0f;
	type		= DIGITAL_SHIFT;
	nextType	= NORMAL;
	stateName	= "DIGITAL_SHIFT";
	onTrans		= false;
	player->setValidOperation(
		DISABLE_OPERATION		//‘€ì•s”\
	);
	//ŒÅ—L€–Ú
	shiftTimer = 0.0f;			//ƒVƒtƒgŽžŠÔ
}

//===================================================================================================================================
//yƒfƒXƒgƒ‰ƒNƒ^z
//===================================================================================================================================
DigitalShiftState::~DigitalShiftState()
{
	
}

//===================================================================================================================================
//yŠJŽnˆ—z
//===================================================================================================================================
void DigitalShiftState::start()
{
	player->effect->play(PlayerEffectNS::DIGHITAL_SHIFT);

}

//===================================================================================================================================
//yXVz
//===================================================================================================================================
void DigitalShiftState::update(float frameTime)
{
	this->frameTime = frameTime;
	stateTimer += frameTime;
	shiftTimer += frameTime;

	if (EFFECT_TIME > effectTimer && effectTimer >= 0.0f )
	{
		effectTimer += frameTime;
	}
	else if(effectTimer > EFFECT_TIME){
		//ƒGƒtƒFƒNƒgŒãƒfƒWƒ^ƒ‹ƒVƒtƒg‚ðŽÀs
		player->executionDigitalShift();
		effectTimer = -1.0f;
	}

	//ó‘Ô‘JˆÚ
	if (shiftTimer > SHIFT_TIME)
	{
		player->returnTransitionCamera(0.25f);
		player->transState(NORMAL); return;//’Êíó‘Ô‚É–ß‚é
	}

}

//===================================================================================================================================
//y‘€ìz
//===================================================================================================================================
void DigitalShiftState::operation()
{
	// ‘€ì
}

//===================================================================================================================================
//y•¨—ˆ—z
//===================================================================================================================================
void DigitalShiftState::physics()
{

}

//===================================================================================================================================
//y•¨—ˆ—z
//===================================================================================================================================
void DigitalShiftState::controlCamera()
{
	if (effectTimer> EFFECT_TIME) {
		//ƒGƒtƒFƒNƒgŒãƒJƒƒ‰‚ð‘JˆÚ
		player->transitionCamera();
	}

	player->controlCamera(frameTime);
}

//===================================================================================================================================
//yó‘Ô‘JˆÚz
//===================================================================================================================================
AbstractState* DigitalShiftState::transition()
{
	return new normalNS::NormalState(player);
}

//===================================================================================================================================
//yI—¹ˆ—z
//===================================================================================================================================
void DigitalShiftState::end()
{
	player->effect->stop(PlayerEffectNS::DIGHITAL_SHIFT);
	player->effect->play(PlayerEffectNS::SHIFT_TERMINATE);
}



