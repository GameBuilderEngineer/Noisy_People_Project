//===================================================================================================================================
//yGameMaster.cppz
// [ì¬Ò]HAL“Œ‹GP12A332 11 ›–ì ÷
// [ì¬“ú]2019/09/20
// [XV“ú]2019/10/25
//===================================================================================================================================
#include "GameMaster.h"
#include "ImguiManager.h"
#include "Input.h"

//===================================================================================================================================
//y–¼‘O‹óŠÔz
//===================================================================================================================================
namespace gameMasterNS
{
	Input* input = NULL;
}

//===================================================================================================================================
//yusingéŒ¾z
//===================================================================================================================================
using namespace gameMasterNS;

//===================================================================================================================================
//yƒRƒ“ƒXƒgƒ‰ƒNƒ^z
//===================================================================================================================================
GameMaster::GameMaster()
{
	gameTimer			= 0.0f;								//ƒQ[ƒ€ŠÔ
	countDownTimer		= 0.0f;								//ƒJƒEƒ“ƒgƒ_ƒEƒ“ŠÔ
	for (int i = 0; i < gameMasterNS::PLAYER_NUM; i++)
	{
		ZeroMemory(&playerInformation[i], sizeof(PlayerTable));
	}
	treeNum				= 0;
	conversionOrder		= NULL;
	input = getInput();
#ifdef _DEBUG
	showGUI = true;
#endif // _DEBUG
}

//===================================================================================================================================
//yƒfƒXƒgƒ‰ƒNƒ^z
//===================================================================================================================================
GameMaster::~GameMaster()
{
	SAFE_DELETE_ARRAY(conversionOrder);
}

//===================================================================================================================================
//y‰Šú‰»z
//===================================================================================================================================
void GameMaster::initialize()
{

}

//===================================================================================================================================
//yXVz
//===================================================================================================================================
void GameMaster::update(float frameTime)
{
	//ƒQ[ƒ€’†‚È‚ç‚ÎAƒ|[ƒYØ‚è‘Ö‚¦ó•t
	if (gameTimer > 0)
	{
		//ƒXƒ^[ƒgƒ{ƒ^ƒ“/‚oƒL[‚ğ“ü—Í‚³‚ê‚½ê‡ƒ|[ƒY‚É‚·‚éB
		if (input->wasKeyPressed('P') || 
			input->getController()[0]->wasButton(virtualControllerNS::SPECIAL_MAIN)||
			input->getController()[1]->wasButton(virtualControllerNS::SPECIAL_MAIN))
		{
			pause = !pause;
		}
	}
}

//===================================================================================================================================
//yƒ|[ƒYˆ—z
//===================================================================================================================================
bool GameMaster::paused()
{
	return pause;
}

//===================================================================================================================================
//yƒQ[ƒ€ŠJnˆ—z
//===================================================================================================================================
void GameMaster::startGame()
{
	gameTimer = GAME_TIME;
	pause = false;
}

//===================================================================================================================================
//yƒQ[ƒ€ŠÔ‚ÌXVz
//===================================================================================================================================
void GameMaster::updateGameTime(float frameTime)
{
	gameTimer -= frameTime;
}

#pragma region conversionOrderFunction
//===================================================================================================================================
//y—Î‰»‚µ‚½–Ø‚Ì–{”‚ğ‹L˜^z
//===================================================================================================================================
void GameMaster::recordGreeningTree(int treeNo, int orderNo)
{
	conversionOrder[treeNo] = orderNo;
}

//===================================================================================================================================
//y•ÏŠ·‡”Ô•Ï”‚ğ€”õ‚·‚éz
//===================================================================================================================================
void GameMaster::readyConversionOrder(int treeNum) {
	this->treeNum = treeNum;								//ŒÍ–ØE—Î‰»–Ø‚Ì‘Œv
	conversionOrder = new int[this->treeNum];
	for (int i = 0; i < this->treeNum; i++)
	{
		conversionOrder[i] = 0;
	}
}

//===================================================================================================================================
//y•ÏŠ·‡”Ô•Ï”‚ğ”jŠü‚·‚éz
//===================================================================================================================================
void GameMaster::discardConversionOrder() {
	this->treeNum = 0;
	SAFE_DELETE_ARRAY(conversionOrder);
}
#pragma endregion

//===================================================================================================================================
//ysetterz
//===================================================================================================================================
void GameMaster::setConversionOrder(int* newValue) {conversionOrder = newValue;};

//===================================================================================================================================
//ygetterz
//===================================================================================================================================
PlayerTable* GameMaster::getPlayerInfomation(){	return playerInformation;}	//ƒvƒŒƒCƒ„[î•ñ‚Ìæ“¾
float GameMaster::getGameTime() {return gameTimer;}							//ƒQ[ƒ€§ŒÀŠÔ‚Ìæ“¾

//===================================================================================================================================
//yGUIz
//===================================================================================================================================
#ifdef _DEBUG
void GameMaster::createGUI()
{
	ImGui::Text("gameTime = %f",		gameTimer);
	ImGui::Text("countDownTimer = %f",	countDownTimer);
	ImGui::Text("TreeNum = %d",	treeNum);
	if (ImGui::CollapsingHeader("TreeOrderList"))
	{
		for (int i = 0; i < treeNum; i++)
		{
			ImGui::Text("conversionOrder[%d] = %d",i, conversionOrder[i]);
		}
	}
}
#endif