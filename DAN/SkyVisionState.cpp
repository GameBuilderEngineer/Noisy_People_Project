//===================================================================================================================================
//ySkyVisionState.cppz
// [ì¬ŽÒ]HAL“Œ‹žGP12A332 11 ›–ì Ž÷
// [ì¬“ú]2019/11/17
// [XV“ú]2019/11/17
//===================================================================================================================================

//===================================================================================================================================
//yƒCƒ“ƒNƒ‹[ƒhz
//===================================================================================================================================
#include "SkyVisionState.h"
#include "DigitalShiftState.h"
#include "NormalState.h"
#include "Input.h"

//===================================================================================================================================
//yusingéŒ¾z
//===================================================================================================================================
using namespace playerNS;
using namespace skyVisionNS;

//===================================================================================================================================
//yƒRƒ“ƒXƒgƒ‰ƒNƒ^z
//===================================================================================================================================
SkyVisionState::SkyVisionState(Player* player) :AbstractState()
{
	this->player	= player;
	stateTimer		= 0.0f;
	type			= SKY_VISION;
	nextType		= NORMAL;
	stateName		= "SKY_VISION";
	onTrans			= false;
	player->setValidOperation(
		ENABLE_CANCEL_SKY_VISION);

}

//===================================================================================================================================
//yƒfƒXƒgƒ‰ƒNƒ^z
//===================================================================================================================================
SkyVisionState::~SkyVisionState()
{

}

//===================================================================================================================================
//yŠJŽnˆ—z
//===================================================================================================================================
void SkyVisionState::start()
{
	player->effect->play(PlayerEffectNS::EFFECT_LIST::SKY_VISION);
	player->effect->play(PlayerEffectNS::EFFECT_LIST::SKY_JUMP);
}

//===================================================================================================================================
//yXVz
//===================================================================================================================================
void SkyVisionState::update(float frameTime)
{
	this->frameTime = frameTime;
	stateTimer += frameTime;

	//“d—ÍÁ”ï
	costTimer += frameTime;
	if (costTimer > COST_TIME)
	{
		player->addpower(-COST);
		costTimer = 0.0f;
	}

	//ó‘Ô‘JˆÚ
	if (player->cancelSkyVision())				return;	//ƒLƒƒƒ“ƒZƒ‹
	else if (player->digitalShift())			return;	//ƒfƒWƒ^ƒ‹ƒVƒtƒg
	else if (player->getPower() <= 0)
	{
		player->returnTransitionCamera(0.5f);

		player->transState(NORMAL);		return;	//’Êíó‘Ô
	}

}


//===================================================================================================================================
//y‘€ìz
//===================================================================================================================================
void SkyVisionState::operation()
{
	// ‘€ì
}

//===================================================================================================================================
//y•¨—ˆ—z
//===================================================================================================================================
void SkyVisionState::physics()
{
}

//===================================================================================================================================
//yƒJƒƒ‰‘€ìz
//===================================================================================================================================
void SkyVisionState::controlCamera()
{
	//ƒJƒƒ‰‘JˆÚ
	player->transitionCamera();
	//ã‹óƒJƒƒ‰‚ð‘€ì
	player->controlSkyCamera();
}

//===================================================================================================================================
//yó‘Ô‘JˆÚz
//===================================================================================================================================
AbstractState* SkyVisionState::transition()
{
	switch (nextType)
	{
	case DIGITAL_SHIFT:
		return new digitalShiftNS::DigitalShiftState(player);
		break;
	case NORMAL:default:
		return new normalNS::NormalState(player);
		break;
	}
}

//===================================================================================================================================
//yI—¹ˆ—z
//===================================================================================================================================
void SkyVisionState::end()
{
	player->effect->stop(PlayerEffectNS::EFFECT_LIST::SKY_VISION);
	player->effect->stop(PlayerEffectNS::EFFECT_LIST::SKY_JUMP);
}

