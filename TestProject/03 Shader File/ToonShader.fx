//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//グローバル
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
float4x4 mProj;
float4x4 mView;
float4x4 mWorld;
float3 LightPos;
float3 EyePos;
float4 Diffuse;
texture ShadeTexture;
texture LineTexture;
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//定義
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
sampler ShadeSampler = sampler_state
{
	Texture = (ShadeTexture);
};

sampler LineSampler = sampler_state
{
	Texture = (LineTexture);
};

struct VS_OUT_PS_IN
{
	float4 Position : POSITION;

	float Line : TEXCOORD;
	float Shade : TEXCOORD1;
};
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//バーテックス・シェーダー
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
VS_OUT_PS_IN VS(float4 Position : POSITION, float3 Normal : NORMAL, float4 Color : COLOR)
{
	VS_OUT_PS_IN Out = (VS_OUT_PS_IN)0;

	Out.Position = mul(Position, mWorld);
	float3 lightVec = normalize(LightPos - Out.Position);
	float3 eyeVec = normalize(EyePos - Out.Position);
	Normal = mul(Normal, (float3x3)mWorld);
	Out.Line = max(dot(Normal, eyeVec), 0);
	Out.Shade = max(dot(Normal, lightVec), 0);
	Out.Position = mul(Out.Position, mul(mView, mProj));

	return Out;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//ピクセル・シェーダー
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
float4 PS(VS_OUT_PS_IN In) : COLOR
{
	float4 Color;

	Color = Diffuse * tex1D(LineSampler, In.Line) * tex1D(ShadeSampler, In.Shade);

	return Color;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// テクニック
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
technique ToonShading
{
	pass Toon
	{
		Sampler[0] = (LineSampler);
		Sampler[1] = (ShadeSampler);

		VertexShader = compile vs_2_0 VS();
		PixelShader = compile ps_2_0 PS();
	}
}